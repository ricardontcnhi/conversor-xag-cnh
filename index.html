<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Conversor Chassi XAG > CNH</title>
<meta name="theme-color" content="#0066cc" />
<link rel="manifest" href="manifest.json" />

<style>
  *, *::before, *::after { box-sizing: border-box; }

  body{
    margin:0;
    font-family:Arial;
    background:#f0f2f5;
    color:#222;
  }
  .header{
    background:#0066cc; color:white; padding:20px; text-align:center;
    font-size:24px; font-weight:bold; box-shadow:0 2px 5px rgba(0,0,0,0.2);
  }
  .container{
    padding:20px; max-width:920px; margin:0 auto;
  }
  .card{
    background:white; border-radius:12px; padding:20px; margin-bottom:20px;
    box-shadow:0 2px 6px rgba(0,0,0,0.15);
  }
  label{
    font-size:16px; font-weight:bold; margin-top:10px; display:block;
  }
  input, select{
    width:100%; padding:15px; border-radius:8px; border:1px solid #ccc;
    margin-top:5px; font-size:16px; display:block;
  }
  button{
    width:100%; background:#0066cc; color:white; border:none; padding:15px;
    border-radius:8px; font-size:18px; margin-top:20px; cursor:pointer;
  }
  button:hover{ background:#0055aa; }
  .copyBtn{ background:#00aa55 !important; }
  #output{
    margin-top:15px; font-size:20px; font-weight:bold; color:green; text-align:center;
  }
  .footer{
    text-align:center; font-size:14px; color:#555; margin-top:20px; margin-bottom:20px;
  }
  .steps{ font-size:16px; line-height:1.6; }
  .steps li{ margin-bottom:12px; }
</style>
</head>

<body>

<!-- Toast de notificação (substitui alert) -->
<div id="toast" style="
  position: fixed; bottom: 25px; left: 50%; transform: translateX(-50%);
  background: #0066cc; color: #fff; padding: 14px 22px; border-radius: 8px;
  font-size: 16px; display: none; z-index: 9999; box-shadow: 0 2px 10px rgba(0,0,0,0.3);
  transition: opacity 0.3s;">
</div>
<script>
  function showToast(msg){
    const t = document.getElementById("toast");
    t.innerText = msg;
    t.style.display = "block";
    t.style.opacity = "1";
    setTimeout(() => {
      t.style.opacity = "0";
      setTimeout(()=>{ t.style.display = "none"; }, 300);
    }, 2200);
  }
</script>

<div class="header">Conversor Chassi XAG > CNH</div>

<div class="container">

  <div class="card">
    <h3>Conversor</h3>

    <label>Chassi XAG:</label>
    <input id="xag" placeholder="Digite o chassi XAG" />

    <label>Marca:</label>
    <select id="marca">
      <option>New Holland</option>
      <option>Case</option>
    </select>

    <label>Kit:</label>
    <select id="kit">
      <option>Basic</option>
      <option>Full</option>
    </select>

    <label>Ano‑modelo:</label>
    <select id="anoModelo">
      <option value="">Selecione...</option>
      <option value="2024">2024</option>
      <option value="2025">2025</option>
      <option value="2026">2026</option>
      <option value="2027">2027</option>
      <option value="2028">2028</option>
    </select>

    <!-- Botão de gerar foi removido; geração agora é automática -->

    <div id="output"></div>
    <button id="copyBtn" class="copyBtn" style="display:none;">Copiar CNH</button>
  </div>

  <div class="card">
    <h3>Como adicionar como App no Celular</h3>
    <ol class="steps">
      <li>Abra este site no navegador Chrome do celular.</li>
      <li>Aguarde aparecer o aviso: <b>“Adicionar à tela inicial”</b>.</li>
      <li>Se não aparecer, toque nos três pontinhos (⋮) do Chrome.</li>
      <li>Toque em <b>Adicionar à tela inicial</b>.</li>
      <li>Confirme e o WebAPK será instalado como aplicativo real.</li>
    </ol>
  </div>

  <div class="card">
    <h3>Como instalar no Computador</h3>
    <ol class="steps">
      <li>Abra o site no Chrome (Windows/Mac).</li>
      <li>Clique no ícone de instalação na barra de endereço (um monitor com setinha).</li>
      <li>Confirme em <b>Instalar</b>.</li>
      <li>O app será instalado como programa independente.</li>
    </ol>
  </div>

  <div class="footer">
    Centro de Treinamento Curitiba - 12/02/2026 - RNT
  </div>

</div>

<script>
// ---------- Tabela VIN (10º dígito) para ano de fabricação XAG ----------
const VIN_YEAR_CODE = {
  2020:'L', 2021:'M', 2022:'N', 2023:'P', 2024:'R', 2025:'S',
  2026:'T', 2027:'V', 2028:'W', 2029:'X'
};

// ---------- Elementos ----------
const $xag       = document.getElementById('xag');
const $marca     = document.getElementById('marca');
const $kit       = document.getElementById('kit');
const $anoModelo = document.getElementById('anoModelo');
const $output    = document.getElementById('output');
const $copyBtn   = document.getElementById('copyBtn');

// ---------- Helpers ----------
function camposProntos(){
  return $xag.value.trim().length >= 18 &&
         $marca.value && $kit.value && $anoModelo.value;
}

function montarCNH(){
  const x = $xag.value.trim();
  const marca = $marca.value;
  const kit   = $kit.value;
  const anoModelo = $anoModelo.value;

  if (!camposProntos()){
    $output.textContent = '';
    $copyBtn.style.display = 'none';
    return;
  }

  // Marca N/C
  const b = (marca === 'New Holland') ? 'N' : 'C';

  // Kit B/F (ajuste se usar S também)
  const c = (kit === 'Basic') ? 'B' : 'F';

  // Ano de fabricação do XAG (pos. 13 → índice 12)
  const anoXAGdigit   = x.charAt(12);
  const anoFabricacao = 2020 + Number(anoXAGdigit);

  const letraBloco = VIN_YEAR_CODE[anoFabricacao];
  if (!letraBloco){
    showToast('Ano XAG fora da faixa suportada (2020–2029).');
    $output.textContent = '';
    $copyBtn.style.display = 'none';
    return;
  }

  // Último dígito do Ano‑modelo selecionado
  const digitoModelo = String(anoModelo).slice(-1);

  // Bloco variante final = [VIN(ano XAG)] + [último dígito do ano‑modelo]
  const blocoVariante = letraBloco + digitoModelo;

  // Partes finais do XAG
  const anoXAG    = x.substring(12,13);
  const semanaXAG = x.substring(13,15);
  const randomXAG = x.substring(15);

  // Montagem CNH
  const r = 'X' +
            x.substring(4,6) +   // produto (24)
            b +                  // N/C
            x.substring(6,8) +   // P1/P2
            c +                  // B/F
            blocoVariante +      // (ex.: S4, T6, W8...)
            anoXAG +
            semanaXAG +
            randomXAG;

  // Exibir + copiar
  $output.textContent = r;
  $copyBtn.style.display = 'block';
  $copyBtn.onclick = () => {
    navigator.clipboard.writeText(r)
      .then(()=> showToast('Chassi CNH copiado!'))
      .catch(()=> showToast('Erro ao copiar'));
  };
}

// ---------- Reagir automaticamente (sem botão) ----------
['input','change','keyup','paste'].forEach(evt => {
  $xag.addEventListener(evt, montarCNH, {passive:true});
});
$marca.addEventListener('change', montarCNH, {passive:true});
$kit.addEventListener('change', montarCNH, {passive:true});
$anoModelo.addEventListener('change', montarCNH, {passive:true});

// Gera ao abrir, caso já existam dados (opcional)
document.addEventListener('DOMContentLoaded', montarCNH);

// ---------- Service Worker ----------
if ('serviceWorker' in navigator) {
  navigator.serviceWorker.register('service-worker.js');
}
</script>

<script>
/* ====== ANTI-CURIOUS (opcional) ====== */
document.addEventListener("contextmenu", (e) => {
  const tag = (e.target.tagName || "").toLowerCase();
  if (["input", "select", "textarea"].includes(tag)) return;
  e.preventDefault();
}, { capture: true });

document.addEventListener("dragstart", (e) => e.preventDefault(), { capture: true });

(function preventCopyAndSelection(){
  const style = document.createElement("style");
  style.innerHTML = `
    body, .container, .card, .header, .footer {
      -webkit-user-select: none; -moz-user-select: none; -ms-user-select: none; user-select: none;
    }
    input, select, textarea {
      -webkit-user-select: text; -moz-user-select: text; -ms-user-select: text; user-select: text;
    }
  `;
  document.head.appendChild(style);

  ["copy","cut"].forEach(evt => {
    document.addEventListener(evt, (e) => {
      const tag = (e.target.tagName || "").toLowerCase();
      if (!["input", "textarea"].includes(tag)) e.preventDefault();
    }, { capture: true });
  });
})();

document.addEventListener("keydown", (e) => {
  const k = e.key.toLowerCase();
  const ctrl = e.ctrlKey || e.metaKey;
  const shift = e.shiftKey;
  if (k === "f12" || (ctrl && shift && ["i","c","j"].includes(k))) {
    e.preventDefault(); e.stopPropagation();
  }
  if (ctrl && ["u","s","p"].includes(k)) {
    e.preventDefault(); e.stopPropagation();
  }
}, { capture: true });

(function blurConsole(){
  if (!window.console) return;
  try {
    const block = () => console.log("%cDevTools desabilitado", "font-size:16px;color:#c00;font-weight:bold");
    ["log","warn","info","debug"].forEach(fn => { try { console[fn] = block; } catch(_){} });
  } catch(_) {}
})();
</script>

</body>
</html>
